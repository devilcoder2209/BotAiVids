{% import 'admin/layout.html' as layout with context -%}
{% import 'admin/static.html' as admin_static with context %}
<!DOCTYPE html>
<html>
  <head>
    <title>{% block title %}{% if admin_view.category %}{{ admin_view.category }} - {% endif %}{{ admin_view.name }} - {{ admin_view.admin.name }}{% endblock %}</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    {% block head_meta %}{% endblock %}
    
    <!-- Bootstrap 5 for consistency with main site -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    {% block head_css %}
    <!-- Custom Admin CSS -->
    <style>
    /* COMPREHENSIVE FLASK-ADMIN OVERRIDE */
    
    /* Base styling */
    body {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
        color: #111827 !important;
        margin: 0 !important;
        padding: 0 !important;
    }
    
    /* Navigation Bar - Complete Override */
    .navbar {
        background: #111827 !important;
        border: none !important;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1) !important;
        padding: 0.75rem 1rem !important;
    }
    
    .navbar-brand {
        color: #ffffff !important;
        font-weight: 700 !important;
        font-size: 1.4rem !important;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5) !important;
    }
    
    .navbar-brand:hover, .navbar-brand:focus {
        color: #ffffff !important;
    }
    
    /* Navigation Links - Default State */
    .navbar-nav .nav-link {
        color: #e5e7eb !important;
        background: transparent !important;
        border: 1px solid transparent !important;
        border-radius: 6px !important;
        padding: 0.5rem 1rem !important;
        margin: 0 0.25rem !important;
        transition: all 0.3s ease !important;
        font-weight: 500 !important;
    }
    
    .navbar-nav .nav-link:hover {
        color: #ffffff !important;
        background: rgba(255, 255, 255, 0.1) !important;
        border-color: rgba(255, 255, 255, 0.2) !important;
    }
    
    /* Dashboard Button - CRITICAL OVERRIDE */
    .navbar-nav .nav-link[href*="admin"],
    .navbar-nav .nav-link[href="/admin"],
    .navbar-nav .nav-link[href$="/admin/"],
    .navbar-nav a[href*="admin"]:not([href*="logout"]) {
        background: linear-gradient(45deg, #f8fafc, #ffffff) !important;
        color: #111827 !important;
        border: 2px solid #e5e7eb !important;
        font-weight: 700 !important;
        text-shadow: none !important;
        text-transform: uppercase !important;
        letter-spacing: 0.5px !important;
        border-radius: 8px !important;
    }
    
    .navbar-nav .nav-link[href*="admin"]:hover,
    .navbar-nav .nav-link[href="/admin"]:hover,
    .navbar-nav .nav-link[href$="/admin/"]:hover,
    .navbar-nav a[href*="admin"]:hover:not([href*="logout"]) {
        background: linear-gradient(45deg, #ffffff, #f1f5f9) !important;
        color: #111827 !important;
        border-color: #d1d5db !important;
        transform: translateY(-2px) !important;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15) !important;
    }
    
    /* Management/User links styling */
    .navbar-nav .nav-link[href*="user"],
    .navbar-nav .nav-link[href*="video"],
    .navbar-nav .nav-link[href*="manage"] {
        background: rgba(99, 102, 241, 0.1) !important;
        color: #6366f1 !important;
        border: 1px solid rgba(99, 102, 241, 0.3) !important;
        font-weight: 600 !important;
    }
    
    .navbar-nav .nav-link[href*="user"]:hover,
    .navbar-nav .nav-link[href*="video"]:hover,
    .navbar-nav .nav-link[href*="manage"]:hover {
        background: rgba(99, 102, 241, 0.2) !important;
        color: #4f46e5 !important;
        border-color: rgba(99, 102, 241, 0.5) !important;
    }
    
    /* Main Content Area */
    .container-fluid, .admin-content, .content {
        background: rgba(255, 255, 255, 0.98) !important;
        color: #111827 !important;
        min-height: calc(100vh - 80px) !important;
        padding: 2rem !important;
        margin-top: 0 !important;
        border-radius: 0 !important;
    }
    
    /* All text elements */
    h1, h2, h3, h4, h5, h6, p, span, div, td, th, label, a, li {
        color: #111827 !important;
    }
    
    /* Tables */
    .table {
        background: white !important;
        border-radius: 12px !important;
        overflow: hidden !important;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1) !important;
    }
    
    .table thead th {
        background: #f8fafc !important;
        color: #111827 !important;
        font-weight: 600 !important;
        border: none !important;
    }
    
    .table tbody td {
        color: #374151 !important;
        border-color: #f1f5f9 !important;
    }
    
    .table tbody tr:hover {
        background: #f8fafc !important;
    }
    
    /* Forms */
    .form-control, .form-select, input, textarea, select {
        color: #111827 !important;
        background: white !important;
        border: 1px solid #d1d5db !important;
        border-radius: 8px !important;
    }
    
    .form-control:focus, .form-select:focus {
        border-color: #6366f1 !important;
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1) !important;
    }
    
    /* Buttons */
    .btn {
        border-radius: 8px !important;
        font-weight: 600 !important;
        transition: all 0.3s ease !important;
    }
    
    .btn-primary {
        background: linear-gradient(45deg, #6366f1, #4f46e5) !important;
        border: none !important;
        color: white !important;
    }
    
    .btn-primary:hover {
        background: linear-gradient(45deg, #4f46e5, #4338ca) !important;
        transform: translateY(-2px) !important;
        box-shadow: 0 8px 25px rgba(99, 102, 241, 0.3) !important;
    }
    
    .btn-success {
        background: linear-gradient(45deg, #059669, #047857) !important;
        border: none !important;
        color: white !important;
    }
    
    .btn-warning {
        background: linear-gradient(45deg, #d97706, #b45309) !important;
        border: none !important;
        color: white !important;
    }
    
    .btn-danger {
        background: linear-gradient(45deg, #dc2626, #b91c1c) !important;
        border: none !important;
        color: white !important;
    }
    
    /* Badges */
    .badge {
        border-radius: 6px !important;
        font-weight: 600 !important;
        color: white !important;
    }
    
    /* Links */
    a:not(.nav-link):not(.btn) {
        color: #6366f1 !important;
        text-decoration: none !important;
    }
    
    a:not(.nav-link):not(.btn):hover {
        color: #4f46e5 !important;
        text-decoration: underline !important;
    }
    
    /* Page headers */
    .page-header, .content-header {
        background: linear-gradient(45deg, #f8fafc, #ffffff) !important;
        border-radius: 12px !important;
        padding: 1.5rem !important;
        margin-bottom: 2rem !important;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1) !important;
        border: 1px solid #e5e7eb !important;
    }
    
    /* Force all Flask-Admin generated elements */
    .model-list *, .model-form *, .admin-content *, 
    .field *, .control-label, .help-inline, .help-block {
        color: #111827 !important;
    }
    
    /* Hide any white text */
    [style*="color: white"], [style*="color:#fff"], [style*="color:#ffffff"] {
        color: #111827 !important;
    }
    
    /* Responsive adjustments */
    @media (max-width: 768px) {
        .navbar-nav {
            padding: 1rem 0 !important;
        }
        
        .navbar-nav .nav-link {
            margin: 0.25rem 0 !important;
            text-align: center !important;
        }
        
        .container-fluid {
            padding: 1rem !important;
        }
    }
    </style>
    {% endblock %}
    
    {% block head %}{% endblock %}
    {% block head_tail %}{% endblock %}
  </head>
  <body>
    {% block page_body %}
    <div class="container-fluid">
      <nav class="navbar navbar-expand-lg">
        <div class="container-fluid">
          {% block brand %}
          <a class="navbar-brand" href="{{ admin_view.admin.url }}">
            <i class="fas fa-shield-alt"></i> {{ admin_view.admin.name }}
          </a>
          {% endblock %}
          
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#admin-navbar">
            <span class="navbar-toggler-icon"></span>
          </button>
          
          <div class="collapse navbar-collapse" id="admin-navbar">
            <ul class="navbar-nav me-auto">
              {% block main_menu %}
              {% set menu = admin_view.admin.menu() %}
              {% for item in menu %}
                {% if item.is_category() %}
                  <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown">
                      {{ item.name }}
                    </a>
                    <ul class="dropdown-menu">
                      {% for child in item.get_children() %}
                        <li><a class="dropdown-item" href="{{ child.get_url() }}">{{ child.name }}</a></li>
                      {% endfor %}
                    </ul>
                  </li>
                {% else %}
                  <li class="nav-item">
                    <a class="nav-link" href="{{ item.get_url() }}">{{ item.name }}</a>
                  </li>
                {% endif %}
              {% endfor %}
              {% endblock %}
            </ul>
          </div>
        </div>
      </nav>
      
      {% block messages %}
      {%- with messages = get_flashed_messages(with_categories=True) -%}
        {% if messages %}
          <div class="flashes">
            {%- for category, message in messages %}
              <div class="alert alert-{{ 'danger' if category=='error' else category }} alert-dismissible">
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                {{ message }}
              </div>
            {%- endfor %}
          </div>
        {% endif %}
      {%- endwith %}
      {% endblock %}
      
      {% set render_ctx = h.resolve_ctx() %}
      
      {% block body %}{% endblock %}
    </div>
    {% endblock %}
    
    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    {% block tail_js %}
    <script>
    // CRITICAL: Dashboard button fix with aggressive DOM targeting
    document.addEventListener('DOMContentLoaded', function() {
        function fixDashboardButtons() {
            // Target all possible Dashboard/Admin links
            const selectors = [
                'a[href*="admin"]',
                'a[href="/admin"]', 
                'a[href$="/admin/"]',
                '.nav-link[href*="admin"]',
                '.navbar-nav a[href*="admin"]'
            ];
            
            selectors.forEach(selector => {
                const links = document.querySelectorAll(selector);
                links.forEach(link => {
                    // Skip logout links
                    if (link.href.includes('logout')) return;
                    
                    // Apply critical styling
                    link.style.setProperty('background', 'linear-gradient(45deg, #f8fafc, #ffffff)', 'important');
                    link.style.setProperty('color', '#111827', 'important');
                    link.style.setProperty('border', '2px solid #e5e7eb', 'important');
                    link.style.setProperty('font-weight', '700', 'important');
                    link.style.setProperty('text-shadow', 'none', 'important');
                    link.style.setProperty('text-transform', 'uppercase', 'important');
                    link.style.setProperty('letter-spacing', '0.5px', 'important');
                    link.style.setProperty('border-radius', '8px', 'important');
                    link.style.setProperty('padding', '0.5rem 1rem', 'important');
                    link.style.setProperty('margin', '0 0.25rem', 'important');
                    
                    // Hover events
                    link.addEventListener('mouseenter', function() {
                        this.style.setProperty('background', 'linear-gradient(45deg, #ffffff, #f1f5f9)', 'important');
                        this.style.setProperty('color', '#111827', 'important');
                        this.style.setProperty('transform', 'translateY(-2px)', 'important');
                        this.style.setProperty('box-shadow', '0 8px 25px rgba(0, 0, 0, 0.15)', 'important');
                    });
                    
                    link.addEventListener('mouseleave', function() {
                        this.style.setProperty('background', 'linear-gradient(45deg, #f8fafc, #ffffff)', 'important');
                        this.style.setProperty('color', '#111827', 'important');
                        this.style.setProperty('transform', 'translateY(0)', 'important');
                        this.style.setProperty('box-shadow', 'none', 'important');
                    });
                });
            });
        }
        
        // Run immediately and with delays
        fixDashboardButtons();
        setTimeout(fixDashboardButtons, 100);
        setTimeout(fixDashboardButtons, 500);
        setTimeout(fixDashboardButtons, 1000);
        
        // Watch for navigation changes
        const observer = new MutationObserver(fixDashboardButtons);
        observer.observe(document.body, { childList: true, subtree: true });
    });
    </script>
    {% endblock %}
  </body>
</html>
